<!DOCTYPE html>
<html lang="ko" xmlns:th="http://thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>프로젝트 메인 페이지</title>

    <meta content="" name="description">
    <meta content="" name="keywords">
    <!-- Favicons -->
    <link th:href="@{/assets/img/favicon.png}" rel="icon">
    <link th:href="@{/assets/img/apple-touch-icon.png}" rel="apple-touch-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>

    <!-- Google Fonts -->
    <link th:href="@{https://fonts.gstatic.com}" rel="preconnect">
    <link
        th:href="@{https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i}"
        rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Vendor CSS Files -->
    <link th:href="@{/assets/vendor/bootstrap-icons/bootstrap-icons.css}" rel="stylesheet">
    <link th:href="@{/assets/vendor/boxicons/css/boxicons.min.css}" rel="stylesheet">
    <link th:href="@{/assets/vendor/quill/quill.snow.css}" rel="stylesheet">
    <link th:href="@{/assets/vendor/quill/quill.bubble.css}" rel="stylesheet">
    <link th:href="@{/assets/vendor/remixicon/remixicon.css}" rel="stylesheet">
    <link th:href="@{/assets/vendor/simple-datatables/style.css}" rel="stylesheet">


    <!-- Template Main CSS File -->
    <link th:href="@{/assets/css/style.css}" rel="stylesheet">







</head>

<body>

    <!-- ======= Header ======= -->
    <header th:replace="/indexcommon/header :: header"></header><!-- End Header -->
    <!-- ======= Sidebar ======= -->
    <aside th:replace="/indexcommon/aside :: aside"></aside><!-- End Sidebar-->

    <main id="main" class="main">
        <div class="pagetitle">
            <h1>프로젝트 관리</h1>
        </div><!-- End Page Title -->




        <!-- 프로젝트 리스트 -->
        <!-- Recent Sales -->
        <div class="col-12">
            <div class="card recent-sales overflow-auto">


                <div class="card-body">
                    <h5 class="card-title">프로젝트 내용</h5>
                    <table>
                        <tr>
                            <th style="width: 100px;">프로젝트 명</th>
                            <td th:text="${projectFind.pj_name}">안녕</td>
                        </tr>
                        <tr>
                            <th style="width: 100px;">시작일</th>
                            <td th:text="${projectFind.pj_startdate}">안녕</td>
                        </tr>
                        <tr>
                            <th style="width: 100px;">종료일</th>
                            <td th:text="${projectFind.pj_enddate}">안녕</td>
                        </tr>
                        <tr>
                            <th style="width: 100px;">내용</th>
                            <td th:text="${projectFind.pj_content}">안녕</td>
                        </tr>
                        <tr>
                            <th style="width: 100px;">현재 진행도</th>
                            <td th:text="${projectFind.pj_percent + '%'}">안녕</td>
                        </tr>

                    </table>
                    <h5 class="card-title">프로젝트 멤버</h5>
                    <table class="table table-borderless">
                        <thead>
                            <tr>
                                <th scope="col">아이디</th>
                                <th scope="col">이름</th>
                                <th scope="col">직급</th>
                                <th scope="col">부서</th>
                                <th scope="col">파트관리</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr th:each="pj_member : ${selectPj_member}">
                                <td th:text="${pj_member.employee_id}"></td>
                                <td th:text="${pj_member.employee_name}"></td>
                                <td th:text="${pj_member.position_type}"></td>
                                <td th:text="${pj_member.organization}"></td>
                                <td>
                                    <button type="button" id="modalShowBtn" class="btn btn-primary"
                                        data-bs-toggle="modal" data-bs-target="#PartModal"
                                        th:data-memberid="${pj_member.employee_id}"
                                        th:data-pjcode="${pj_member.pj_code}"
                                        th:data-membername="${pj_member.employee_name}">
                                        파트추가
                                    </button>
                                </td>


                            </tr>
                        </tbody>
                    </table>
                    <h5 class="card-title">업무 상황</h5>
                    <table class="table table-borderless">
                        <thead>
                            <tr id="partList">
                                <th scope="col">파트내용</th>
                                <th scope="col">해당 파트 담당자</th>
                                <th scope="col">진행상황</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="pj_part : ${projectPart}">
                                <td th:text="${pj_part.pj_part_content}"></td>
                                <td th:text="${pj_part.employee_name}"></td>
                                <td>진행중</td>
                            </tr>

                        </tbody>
                    </table>

                </div>

            </div>
        </div><!-- End Recent Sales -->


        <!--
    프로젝트 진행도(여러개일경우 1,2,3 버튼으로)  // 해야할 파트 간략히 1,2,3



    현재 프로젝트 리스트
    ---------------------
    #1 프로젝트1  각종정보   +버튼으로 펼치고 접기
        나
        - 담당 파트1 +버튼으로 펼치고 접기 진행중/완료 확인 취소버튼
        - 담당 파트2 +버튼으로 펼치고 접기 진행중/완료 확인 취소버튼
    #1 프로젝트 +펼치면
    내용


    프로젝트 생성 버튼
-->


        <div class="modal fade" id="PartModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title">파트 추가</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                        <div class="card-header text-center">
                            <b id="test" style="color : black">업무 입력</b>
                        </div>

                        <!-- <div class="col-sm-12">
                                <textarea name="pj_part_content" id="pj_part_content" class="form-control"
                                    style="height: 100px" required></textarea>
                            </div> -->
                        <hr>
                        <textarea id="PartVal" class="form-control" rows="8"></textarea>
                        <hr>
                        <div hidden>
                            <input type="text" readonly class="data form-control-plaintext" id="memberid">
                            <input type="text" readonly class="data form-control-plaintext" id="pjcode">
                            <input type="text" readonly class="data form-control-plaintext" id="membername">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="addPart">파트 추가</button>
                        <button type="button" class="btn btn-danger" id="closeButton"
                            data-bs-dismiss="modal">닫기</button>
                    </div>
                </div>
            </div>
        </div>

    </main><!-- End #main -->



    <script type="text/javascript">
        $(document).on('click', '#modalShowBtn', function () {
            let data = $(this).data();
            for (key in data) {
                let id = document.getElementById(key);
                if (id != null) {
                    let datum = data[key];
                    id.value = datum;
                }
            }

        })

    </script>





    <!-- ======= Footer ======= -->
    <footer id="footer" class="footer">
        <div class="copyright">
            &copy; Copyright <strong><span>NiceAdmin</span></strong>. All Rights Reserved
        </div>
        <div class="credits">
            <!-- All the links in the footer should remain intact. -->
            <!-- You can delete the links only if you purchased the pro version. -->
            <!-- Licensing information: https://bootstrapmade.com/license/ -->
            <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/ -->
            Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
        </div>
    </footer><!-- End Footer -->

    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>

    <!-- Vendor JS Files -->
    <script th:src="@{/assets/vendor/apexcharts/apexcharts.min.js}"></script>
    <script th:src="@{/assets/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/assets/vendor/chart.js/chart.min.js}"></script>
    <script th:src="@{/assets/vendor/echarts/echarts.min.js}"></script>
    <script th:src="@{/assets/vendor/quill/quill.min.js}"></script>
    <script th:src="@{/assets/vendor/simple-datatables/simple-datatables.js}"></script>
    <script th:src="@{/assets/vendor/tinymce/tinymce.min.js}"></script>
    <script th:src="@{/assets/vendor/php-email-form/validate.js}"></script>

    <!-- Template Main JS File -->
    <script th:src="@{/assets/js/main.js}"></script>

    <!-- 제이쿼리, 에이젝스 -->
    <script th:src="@{/assets/js/jquery-3.6.0.js}"></script>


    <SCRIPT LANGUAGE="JavaScript">


        $(document).ready(function () {
            $('#addPart').on('click', function () {
                alert('파트추가완료');

                let addPart = $('#PartVal').val();
                let memberid = $('#memberid').val();
                let pjcode = $('#pjcode').val();
                let membername = $('#membername').val();
                if (addPart == null) {
                    return false;
                }
                $.ajax({
                    url: 'addPart',
                    type: 'post',
                    data: { pj_part_content: addPart, employee_id: memberid, pj_code: pjcode, employee_name: membername },
                    success: function (data) {
                        if (data == 1) {
                            console.log('저장 성공');
                        } else {
                            console.log('저장 실패');
                        }
                    },
                    error: function (e) {
                        console.log(e.responseText);
                    }
                });
                // $('#partList').after(`<tr>
                //         <td>DB작업</td>
                //         <td>김사원</td>
                //         <td>진행중</td>
                //     </tr>`)

            });

        });

    </SCRIPT>


</body>

</html>